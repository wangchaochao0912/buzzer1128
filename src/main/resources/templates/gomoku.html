<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>五子棋小游戏</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f0f0f0;
        }
        h1 {
            color: #333;
        }
        #gameInfo {
            margin: 20px;
            font-size: 18px;
        }
        #gameButtons {
            margin: 20px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            margin: 0 10px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
        }
        button:hover {
            background-color: #45a049;
        }
        #exitButton {
            background-color: #f44336;
        }
        #exitButton:hover {
            background-color: #da190b;
        }
        .game-container {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            justify-content: center;
        }
        .board-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .gameBoard {
            border: 2px solid #333;
            margin: 10px auto;
            background-color: #deb887;
        }
        .board-status {
            margin-top: 10px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <h1>五子棋小游戏</h1>
    <div id="gameInfo">
        <p>当前玩家：<span id="currentPlayer">黑子</span></p>
    </div>
    <div class="game-container">
        <div class="board-wrapper">
            <h2>棋盘 1</h2>
            <canvas id="gameBoard1" class="gameBoard" width="450" height="450"></canvas>
            <div id="board1Status" class="board-status">游戏未开始</div>
        </div>
        <div class="board-wrapper">
            <h2>棋盘 2</h2>
            <canvas id="gameBoard2" class="gameBoard" width="450" height="450"></canvas>
            <div id="board2Status" class="board-status">游戏未开始</div>
        </div>
    </div>
    <div id="gameButtons">
        <button id="startButton">开始游戏</button>
        <button id="exitButton">退出游戏</button>
    </div>

    <script>
        // 游戏状态
        let board1 = [];
        let board2 = [];
        let currentPlayer = 1; // 1: 黑子, 2: 白子
        let game1Active = false;
        let game2Active = false;
        const boardSize = 15;
        const cellSize = 30;

        // 获取画布和上下文
        const canvas1 = document.getElementById('gameBoard1');
        const ctx1 = canvas1.getContext('2d');
        const canvas2 = document.getElementById('gameBoard2');
        const ctx2 = canvas2.getContext('2d');

        // 绘制棋盘
        function drawBoard(boardIndex) {
            const canvas = boardIndex === 1 ? canvas1 : canvas2;
            const ctx = boardIndex === 1 ? ctx1 : ctx2;
            const board = boardIndex === 1 ? board1 : board2;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // 绘制网格线
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 1;
            for (let i = 0; i <= boardSize; i++) {
                // 垂直线
                ctx.beginPath();
                ctx.moveTo(i * cellSize + cellSize / 2, cellSize / 2);
                ctx.lineTo(i * cellSize + cellSize / 2, boardSize * cellSize + cellSize / 2);
                ctx.stroke();
                
                // 水平线
                ctx.beginPath();
                ctx.moveTo(cellSize / 2, i * cellSize + cellSize / 2);
                ctx.lineTo(boardSize * cellSize + cellSize / 2, i * cellSize + cellSize / 2);
                ctx.stroke();
            }
            
            // 绘制棋子
            for (let i = 0; i < boardSize; i++) {
                for (let j = 0; j < boardSize; j++) {
                    if (board[i][j] !== 0) {
                        drawPiece(boardIndex, i, j, board[i][j]);
                    }
                }
            }
        }

        // 绘制棋子
        function drawPiece(boardIndex, row, col, player) {
            const canvas = boardIndex === 1 ? canvas1 : canvas2;
            const ctx = boardIndex === 1 ? ctx1 : ctx2;
            const x = col * cellSize + cellSize / 2;
            const y = row * cellSize + cellSize / 2;
            
            ctx.beginPath();
            ctx.arc(x, y, cellSize / 2 - 2, 0, Math.PI * 2);
            ctx.fillStyle = player === 1 ? '#000' : '#fff';
            ctx.fill();
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.stroke();
        }

        // 处理棋盘点击
        function handleBoardClick(event, boardIndex) {
            const gameActive = boardIndex === 1 ? game1Active : game2Active;
            if (!gameActive) return;
            
            const canvas = boardIndex === 1 ? canvas1 : canvas2;
            const rect = canvas.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            
            const col = Math.round((x - cellSize / 2) / cellSize);
            const row = Math.round((y - cellSize / 2) / cellSize);
            
            const board = boardIndex === 1 ? board1 : board2;
            if (row >= 0 && row < boardSize && col >= 0 && col < boardSize && board[row][col] === 0) {
                // 发送落子请求到后端
                fetch('/game/move', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({boardIndex: boardIndex, row: row, col: col})
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        board1 = data.board1;
                        board2 = data.board2;
                        currentPlayer = data.currentPlayer;
                        game1Active = data.game1Active;
                        game2Active = data.game2Active;
                        drawBoard(1);
                        drawBoard(2);
                        document.getElementById('currentPlayer').textContent = currentPlayer === 1 ? '黑子' : '白子';
                        updateBoardStatus(1);
                        updateBoardStatus(2);
                        
                        if (data.bothGamesWon) {
                            alert('恭喜！两场游戏都胜利了！');
                        }
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            }
        }

        // 更新棋盘状态显示
        function updateBoardStatus(boardIndex) {
            const statusElement = document.getElementById(`board${boardIndex}Status`);
            const gameActive = boardIndex === 1 ? game1Active : game2Active;
            if (gameActive) {
                statusElement.textContent = '游戏进行中';
            } else {
                statusElement.textContent = '游戏已胜利';
            }
        }

        // 开始游戏
        function startGame() {
            // 发送开始游戏请求到后端
            fetch('/game/start', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    board1 = data.board1;
                    board2 = data.board2;
                    currentPlayer = data.currentPlayer;
                    game1Active = data.game1Active;
                    game2Active = data.game2Active;
                    drawBoard(1);
                    drawBoard(2);
                    document.getElementById('currentPlayer').textContent = currentPlayer === 1 ? '黑子' : '白子';
                    updateBoardStatus(1);
                    updateBoardStatus(2);
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }

        // 退出游戏
        function exitGame() {
            if (confirm('确定要退出游戏吗？')) {
                // 发送退出游戏请求到后端
                fetch('/game/exit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        game1Active = false;
                        game2Active = false;
                        ctx1.clearRect(0, 0, canvas1.width, canvas1.height);
                        ctx2.clearRect(0, 0, canvas2.width, canvas2.height);
                        document.getElementById('currentPlayer').textContent = '黑子';
                        document.getElementById('board1Status').textContent = '游戏未开始';
                        document.getElementById('board2Status').textContent = '游戏未开始';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            }
        }

        // 绑定事件
        document.getElementById('startButton').addEventListener('click', startGame);
        document.getElementById('exitButton').addEventListener('click', exitGame);
        canvas1.addEventListener('click', (event) => handleBoardClick(event, 1));
        canvas2.addEventListener('click', (event) => handleBoardClick(event, 2));
    </script>
</body>
</html>
