<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trae AI数据</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 24px 32px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
            margin-bottom: 24px;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 16px;
        }

        .user-info {
            display: flex;
            gap: 32px;
            flex-wrap: wrap;
        }

        .user-info-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #5a6c7d;
            font-size: 14px;
        }

        .user-info-item i {
            color: #3498db;
        }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
            border: none;
            margin-bottom: 24px;
        }

        .card-header {
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            padding: 20px 24px;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-header h2 {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin: 0;
        }

        .btn {
            border-radius: 8px;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #3498db;
            border: none;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
        }

        .form-section {
            padding: 24px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }

        .form-group {
            margin-bottom: 0;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            color: #2c3e50;
            font-weight: 500;
            font-size: 14px;
        }

        .form-control, .form-select {
            border: 1px solid #dfe6e9;
            border-radius: 8px;
            padding: 10px 12px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-control:focus, .form-select:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .table-container {
            padding: 0 24px 24px;
        }

        .table {
            margin-bottom: 0;
        }

        .table th {
            background: #f8f9fa;
            color: #2c3e50;
            font-weight: 600;
            font-size: 14px;
            border: none;
            padding: 12px 8px;
        }

        .table td {
            color: #5a6c7d;
            font-size: 14px;
            border: none;
            padding: 12px 8px;
        }

        .table tbody tr {
            transition: all 0.2s ease;
        }

        .table tbody tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-approved {
            background: #d4edda;
            color: #155724;
        }

        .status-rejected {
            background: #f8d7da;
            color: #721c24;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .btn-sm {
            padding: 4px 12px;
            font-size: 12px;
        }

        .btn-success {
            background: #27ae60;
            border: none;
        }

        .btn-success:hover {
            background: #229954;
        }

        .btn-warning {
            background: #f39c12;
            border: none;
        }

        .btn-warning:hover {
            background: #e67e22;
        }

        .btn-danger {
            background: #e74c3c;
            border: none;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .modal-content {
            border-radius: 12px;
            border: none;
        }

        .modal-header {
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            border-radius: 12px 12px 0 0;
            padding: 20px 24px;
        }

        .modal-header h5 {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin: 0;
        }

        .modal-body {
            padding: 24px;
        }

        .collection-item {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
        }

        .collection-item input {
            flex: 1;
        }

        .pagination {
            margin-top: 20px;
            justify-content: center;
        }

        .page-link {
            color: #3498db;
            border: 1px solid #dfe6e9;
            border-radius: 8px;
            margin: 0 4px;
            transition: all 0.3s ease;
        }

        .page-link:hover {
            background: #f8f9fa;
            border-color: #3498db;
            color: #2980b9;
        }

        .page-item.active .page-link {
            background: #3498db;
            border-color: #3498db;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-database me-2"></i>Trae AI数据</h1>
            <div class="user-info">
                <div class="user-info-item">
                    <i class="fas fa-user"></i>
                    <span>用户id：1875084792839892</span>
                </div>
                <div class="user-info-item">
                    <i class="fas fa-id-card"></i>
                    <span>千识id：4771</span>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h2>案例数据管理</h2>
                <button class="btn btn-primary" onclick="openAddModal()">
                    <i class="fas fa-plus me-1"></i>新增案例
                </button>
            </div>

            <div class="form-section">
                <div class="form-row">
                    <div class="form-group">
                        <label for="searchName">名称模糊查询</label>
                        <input type="text" id="searchName" class="form-control" placeholder="输入名称进行查询">
                    </div>
                    <div class="form-group">
                        <label for="startDate">开始日期</label>
                        <input type="date" id="startDate" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="endDate">结束日期</label>
                        <input type="date" id="endDate" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="searchStatus">状态查询</label>
                        <select id="searchStatus" class="form-select">
                            <option value="">全部</option>
                            <option value="审核中">审核中</option>
                            <option value="已通过">已通过</option>
                            <option value="未通过">未通过</option>
                        </select>
                    </div>
                </div>
                <div class="d-flex gap-2">
                    <button class="btn btn-primary" onclick="searchData()">
                        <i class="fas fa-search me-1"></i>查询
                    </button>
                    <button class="btn btn-secondary" onclick="resetSearch()">
                        <i class="fas fa-redo me-1"></i>重置
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>名称</th>
                            <th>创建时间</th>
                            <th>修改时间</th>
                            <th>状态</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="dataTableBody">
                    </tbody>
                </table>

                <nav>
                    <ul class="pagination" id="pagination">
                    </ul>
                </nav>
            </div>
        </div>
    </div>

    <!-- 新增/编辑模态框 -->
    <div class="modal fade" id="dataModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 id="modalTitle">新增案例</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="modalId">
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="modalName">名称 *</label>
                            <input type="text" id="modalName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="modalRepo">仓库 *</label>
                            <input type="text" id="modalRepo" class="form-control" required>
                        </div>
                    </div>

                    <div class="form-group mb-3">
                        <label for="modalDesc">简介</label>
                        <textarea id="modalDesc" class="form-control" rows="3"></textarea>
                    </div>

                    <div class="form-group mb-3">
                        <label for="modalStatus">状态 *</label>
                        <select id="modalStatus" class="form-select" required>
                            <option value="审核中">审核中</option>
                            <option value="已通过">已通过</option>
                            <option value="未通过">未通过</option>
                        </select>
                    </div>

                    <div class="form-group mb-3">
                        <label>Session IDs</label>
                        <div id="sessionIdsContainer"></div>
                        <button type="button" class="btn btn-sm btn-outline-primary mt-2" onclick="addSessionId()">
                            <i class="fas fa-plus me-1"></i>添加
                        </button>
                    </div>

                    <div class="form-group mb-3">
                        <label>PRs</label>
                        <div id="prsContainer"></div>
                        <button type="button" class="btn btn-sm btn-outline-primary mt-2" onclick="addPr()">
                            <i class="fas fa-plus me-1"></i>添加
                        </button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" onclick="saveData()">保存</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 详情模态框 -->
    <div class="modal fade" id="detailModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5>案例详情</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-sm-3">
                            <strong>ID:</strong>
                        </div>
                        <div class="col-sm-9" id="detailId"></div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-sm-3">
                            <strong>名称:</strong>
                        </div>
                        <div class="col-sm-9" id="detailName"></div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-sm-3">
                            <strong>仓库:</strong>
                        </div>
                        <div class="col-sm-9" id="detailRepo"></div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-sm-3">
                            <strong>简介:</strong>
                        </div>
                        <div class="col-sm-9" id="detailDesc"></div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-sm-3">
                            <strong>状态:</strong>
                        </div>
                        <div class="col-sm-9" id="detailStatus"></div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-sm-3">
                            <strong>Session IDs:</strong>
                        </div>
                        <div class="col-sm-9" id="detailSessionIds"></div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-sm-3">
                            <strong>PRs:</strong>
                        </div>
                        <div class="col-sm-9" id="detailPrs"></div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-sm-3">
                            <strong>创建时间:</strong>
                        </div>
                        <div class="col-sm-9" id="detailCreateTime"></div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-sm-3">
                            <strong>修改时间:</strong>
                        </div>
                        <div class="col-sm-9" id="detailUpdateTime"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let dataList = [];
        let currentPage = 1;
        let pageSize = 10;
        let totalPages = 1;

        // 初始化数据
        function initData() {
            dataList = [
                {
                    id: 1,
                    name: "案例1",
                    repo: "repo1",
                    desc: "这是案例1的简介",
                    status: "审核中",
                    sessionIds: ["session1", "session2"],
                    prs: ["pr1", "pr2", "pr3"],
                    createTime: "2023-10-01 10:00:00",
                    updateTime: "2023-10-01 10:00:00"
                },
                {
                    id: 2,
                    name: "案例2",
                    repo: "repo2",
                    desc: "这是案例2的简介",
                    status: "已通过",
                    sessionIds: ["session3"],
                    prs: ["pr4"],
                    createTime: "2023-10-02 11:00:00",
                    updateTime: "2023-10-02 11:00:00"
                },
                {
                    id: 3,
                    name: "案例3",
                    repo: "repo3",
                    desc: "这是案例3的简介",
                    status: "未通过",
                    sessionIds: [],
                    prs: [],
                    createTime: "2023-10-03 12:00:00",
                    updateTime: "2023-10-03 12:00:00"
                }
            ];
        }

        // 渲染表格
        function renderTable() {
            const tbody = document.getElementById('dataTableBody');
            tbody.innerHTML = '';

            const start = (currentPage - 1) * pageSize;
            const end = start + pageSize;
            const pageData = dataList.slice(start, end);

            pageData.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.id}</td>
                    <td>${item.name}</td>
                    <td>${item.createTime}</td>
                    <td>${item.updateTime}</td>
                    <td>
                        <span class="status-badge status-${item.status === '审核中' ? 'pending' : item.status === '已通过' ? 'approved' : 'rejected'}">
                            ${item.status}
                        </span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-success" onclick="viewDetail(${item.id})">
                                <i class="fas fa-eye"></i> 查看
                            </button>
                            <button class="btn btn-sm btn-warning" onclick="openEditModal(${item.id})">
                                <i class="fas fa-edit"></i> 编辑
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteData(${item.id})">
                                <i class="fas fa-trash"></i> 删除
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });

            renderPagination();
        }

        // 渲染分页
        function renderPagination() {
            totalPages = Math.ceil(dataList.length / pageSize);
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';

            // 上一页
            const prevItem = document.createElement('li');
            prevItem.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
            prevItem.innerHTML = `<a class="page-link" href="#" onclick="changePage(${currentPage - 1}); return false;">上一页</a>`;
            pagination.appendChild(prevItem);

            // 页码
            for (let i = 1; i <= totalPages; i++) {
                const pageItem = document.createElement('li');
                pageItem.className = `page-item ${i === currentPage ? 'active' : ''}`;
                pageItem.innerHTML = `<a class="page-link" href="#" onclick="changePage(${i}); return false;">${i}</a>`;
                pagination.appendChild(pageItem);
            }

            // 下一页
            const nextItem = document.createElement('li');
            nextItem.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
            nextItem.innerHTML = `<a class="page-link" href="#" onclick="changePage(${currentPage + 1}); return false;">下一页</a>`;
            pagination.appendChild(nextItem);
        }

        // 改变页码
        function changePage(page) {
            if (page < 1 || page > totalPages) return;
            currentPage = page;
            renderTable();
        }

        // 打开新增模态框
        function openAddModal() {
            document.getElementById('modalTitle').textContent = '新增案例';
            document.getElementById('modalId').value = '';
            document.getElementById('modalName').value = '';
            document.getElementById('modalRepo').value = '';
            document.getElementById('modalDesc').value = '';
            document.getElementById('modalStatus').value = '审核中';

            // 清空集合
            document.getElementById('sessionIdsContainer').innerHTML = '';
            document.getElementById('prsContainer').innerHTML = '';

            // 添加一个空的
            addSessionId();
            addPr();

            const modal = new bootstrap.Modal(document.getElementById('dataModal'));
            modal.show();
        }

        // 打开编辑模态框
        function openEditModal(id) {
            const item = dataList.find(d => d.id === id);
            if (!item) return;

            document.getElementById('modalTitle').textContent = '编辑案例';
            document.getElementById('modalId').value = item.id;
            document.getElementById('modalName').value = item.name;
            document.getElementById('modalRepo').value = item.repo;
            document.getElementById('modalDesc').value = item.desc;
            document.getElementById('modalStatus').value = item.status;

            // 渲染Session IDs
            const sessionContainer = document.getElementById('sessionIdsContainer');
            sessionContainer.innerHTML = '';
            if (item.sessionIds && item.sessionIds.length > 0) {
                item.sessionIds.forEach(id => {
                    addSessionId(id);
                });
            } else {
                addSessionId();
            }

            // 渲染PRs
            const prContainer = document.getElementById('prsContainer');
            prContainer.innerHTML = '';
            if (item.prs && item.prs.length > 0) {
                item.prs.forEach(pr => {
                    addPr(pr);
                });
            } else {
                addPr();
            }

            const modal = new bootstrap.Modal(document.getElementById('dataModal'));
            modal.show();
        }

        // 添加Session ID输入框
        function addSessionId(value = '') {
            const container = document.getElementById('sessionIdsContainer');
            const div = document.createElement('div');
            div.className = 'collection-item';
            div.innerHTML = `
                <input type="text" class="form-control" value="${value}">
                <button type="button" class="btn btn-sm btn-danger" onclick="removeParent(this)">
                    <i class="fas fa-times"></i>
                </button>
            `;
            container.appendChild(div);
        }

        // 添加PR输入框
        function addPr(value = '') {
            const container = document.getElementById('prsContainer');
            const div = document.createElement('div');
            div.className = 'collection-item';
            div.innerHTML = `
                <input type="text" class="form-control" value="${value}">
                <button type="button" class="btn btn-sm btn-danger" onclick="removeParent(this)">
                    <i class="fas fa-times"></i>
                </button>
            `;
            container.appendChild(div);
        }

        // 移除父元素
        function removeParent(btn) {
            btn.parentElement.remove();
        }

        // 保存数据
        function saveData() {
            const id = document.getElementById('modalId').value;
            const name = document.getElementById('modalName').value;
            const repo = document.getElementById('modalRepo').value;
            const desc = document.getElementById('modalDesc').value;
            const status = document.getElementById('modalStatus').value;

            // 获取Session IDs
            const sessionInputs = document.querySelectorAll('#sessionIdsContainer input');
            const sessionIds = Array.from(sessionInputs).map(input => input.value.trim()).filter(value => value);

            // 获取PRs
            const prInputs = document.querySelectorAll('#prsContainer input');
            const prs = Array.from(prInputs).map(input => input.value.trim()).filter(value => value);

            if (!name || !repo || !status) {
                alert('请填写必填字段');
                return;
            }

            const now = new Date().toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            }).replace(/\//g, '-');

            if (id) {
                // 编辑
                const index = dataList.findIndex(d => d.id == id);
                if (index !== -1) {
                    dataList[index] = {
                        ...dataList[index],
                        name,
                        repo,
                        desc,
                        status,
                        sessionIds,
                        prs,
                        updateTime: now
                    };
                }
            } else {
                // 新增
                const newId = dataList.length > 0 ? Math.max(...dataList.map(d => d.id)) + 1 : 1;
                dataList.push({
                    id: newId,
                    name,
                    repo,
                    desc,
                    status,
                    sessionIds,
                    prs,
                    createTime: now,
                    updateTime: now
                });
            }

            // 关闭模态框
            const modal = bootstrap.Modal.getInstance(document.getElementById('dataModal'));
            modal.hide();

            // 刷新数据
            currentPage = 1;
            renderTable();
        }

        // 查看详情
        function viewDetail(id) {
            const item = dataList.find(d => d.id === id);
            if (!item) return;

            document.getElementById('detailId').textContent = item.id;
            document.getElementById('detailName').textContent = item.name;
            document.getElementById('detailRepo').textContent = item.repo;
            document.getElementById('detailDesc').textContent = item.desc || '无';
            
            const statusBadge = document.createElement('span');
            statusBadge.className = `status-badge status-${item.status === '审核中' ? 'pending' : item.status === '已通过' ? 'approved' : 'rejected'}`;
            statusBadge.textContent = item.status;
            document.getElementById('detailStatus').innerHTML = '';
            document.getElementById('detailStatus').appendChild(statusBadge);

            document.getElementById('detailSessionIds').textContent = item.sessionIds && item.sessionIds.length > 0 ? item.sessionIds.join(', ') : '无';
            document.getElementById('detailPrs').textContent = item.prs && item.prs.length > 0 ? item.prs.join(', ') : '无';
            document.getElementById('detailCreateTime').textContent = item.createTime;
            document.getElementById('detailUpdateTime').textContent = item.updateTime;

            const modal = new bootstrap.Modal(document.getElementById('detailModal'));
            modal.show();
        }

        // 删除数据
        function deleteData(id) {
            // 先找到要删除的数据
            const dataToDelete = dataList.find(d => d.id === id);
            if (!dataToDelete) return;

            // 弹出确认对话框
            if (!confirm('确定要删除这条数据吗？')) return;

            // 确认后再删除数据
            dataList = dataList.filter(d => d.id !== id);

            // 刷新数据
            if (currentPage > Math.ceil(dataList.length / pageSize)) {
                currentPage = Math.ceil(dataList.length / pageSize) || 1;
            }
            renderTable();
        }

        // 查询数据
        function searchData() {
            const name = document.getElementById('searchName').value.trim();
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const status = document.getElementById('searchStatus').value;

            // 这里应该是实际的API调用，现在用模拟数据
            // 先保存原始数据？或者重新获取？
            // 这里简化处理，直接过滤当前数据

            let filtered = [...dataList];

            if (name) {
                filtered = filtered.filter(item => item.name.includes(name));
            }

            if (status) {
                filtered = filtered.filter(item => item.status === status);
            }

            if (startDate) {
                filtered = filtered.filter(item => {
                    const itemDate = item.createTime.split(' ')[0];
                    return itemDate >= startDate;
                });
            }

            if (endDate) {
                filtered = filtered.filter(item => {
                    const itemDate = item.createTime.split(' ')[0];
                    return itemDate <= endDate;
                });
            }

            dataList = filtered;
            currentPage = 1;
            renderTable();
        }

        // 重置查询
        function resetSearch() {
            document.getElementById('searchName').value = '';
            document.getElementById('startDate').value = '';
            document.getElementById('endDate').value = '';
            document.getElementById('searchStatus').value = '';

            // 重新初始化数据
            initData();
            currentPage = 1;
            renderTable();
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            initData();
            renderTable();
        });
    </script>
</body>
</html>